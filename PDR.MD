# PDR - Product Definition Record
# EDA-Lab : Simulateur d'Architecture Ã‰vÃ©nementielle

**Version :** 1.0
**Date :** 2026-01-19
**Statut :** ApprouvÃ©

---

## 1. Vue d'ensemble

### 1.1 Description du projet

**EDA-Lab** est une application acadÃ©mique de simulation d'interopÃ©rabilitÃ© dans un Ã©cosystÃ¨me d'entreprise fondÃ© sur l'architecture Ã©vÃ©nementielle (EDA - Event Driven Architecture). L'application permet d'apprendre et d'expÃ©rimenter l'implÃ©mentation et l'exploitation des patrons d'architecture EDA Ã  travers une simulation automatisÃ©e de domaines mÃ©tier interconnectÃ©s.

### 1.2 Contexte

| Ã‰lÃ©ment | Description |
|---------|-------------|
| **Type** | Outil d'apprentissage personnel |
| **Utilisateur cible** | Architecte de domaine spÃ©cialisÃ© en interopÃ©rabilitÃ© des systÃ¨mes |
| **Approche** | ItÃ©rative et incrÃ©mentale |
| **GÃ©nÃ©ration** | Claude Code + Google Antigravity |

### 1.3 Objectifs d'apprentissage

| PrioritÃ© | Objectif |
|----------|----------|
| **1** | MaÃ®triser l'implÃ©mentation technique des patrons EDA avec Apache Kafka |
| **2** | Comprendre les compromis architecturaux (couplage, latence, rÃ©silience) |
| **3** | Visualiser les flux d'Ã©vÃ©nements en temps rÃ©el dans une simulation entiÃ¨rement automatisÃ©e |

---

## 2. Domaine mÃ©tier

### 2.1 Domaines simulÃ©s

L'application simule un **Ã©cosystÃ¨me de groupe financier intÃ©grÃ©** composÃ© de trois domaines :

| Domaine | Description |
|---------|-------------|
| **Bancaire** | Gestion des comptes, transactions, virements |
| **Assurance de Personne** | Contrats vie, santÃ©, prÃ©voyance |
| **Assurance Dommage** | Contrats auto, habitation, sinistres |

### 2.2 Flux d'interopÃ©rabilitÃ©

Les trois domaines partagent des Ã©vÃ©nements selon les flux suivants :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BANCAIRE   â”‚â—„â”€â”€â”€â”€â”¤    CLIENT 360Â°      â”œâ”€â”€â”€â”€â–ºâ”‚ ASSURANCE PERS.  â”‚
â”‚             â”‚     â”‚  (Vue unifiÃ©e)      â”‚     â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                  â”‚
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
       â”‚            â”‚ ASSURANCE DOMMAGE   â”‚              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Flux | Description |
|------|-------------|
| **Client 360Â°** | Vision unifiÃ©e du client partagÃ©e entre tous les domaines |
| **Paiement de primes** | PrÃ©lÃ¨vement des primes d'assurance via le compte bancaire |
| **Indemnisation sinistres** | Versement des indemnisations sur le compte bancaire |

---

## 3. Catalogue des patrons EDA

### 3.1 Ordre d'implÃ©mentation

| ItÃ©ration | Patron | Description |
|-----------|--------|-------------|
| **1** | **Producteur/Consommateur (Pub/Sub)** | Pattern de base - publication et consommation d'Ã©vÃ©nements |
| **2** | **Event Sourcing** | Stockage de l'Ã©tat comme sÃ©quence d'Ã©vÃ©nements |
| **3** | **CQRS** | SÃ©paration des modÃ¨les de lecture et d'Ã©criture |
| **4** | **Saga Choreography** | Transactions distribuÃ©es par Ã©vÃ©nements dÃ©centralisÃ©s |
| **5** | **Saga Orchestration** | Transactions distribuÃ©es par coordinateur central |
| **6** | **Event Streaming** | Traitement continu de flux avec Kafka Streams |
| **7** | **Dead Letter Queue** | Gestion des Ã©vÃ©nements en erreur |
| **8** | **Outbox Pattern** | Garantie de livraison transactionnelle |

---

## 4. Catalogue des Ã©vÃ©nements

### 4.1 Domaine Bancaire

| Ã‰vÃ©nement | Description |
|-----------|-------------|
| `CompteOuvert` | Ouverture d'un nouveau compte bancaire |
| `CompteFerme` | Fermeture d'un compte bancaire |
| `DepotEffectue` | DÃ©pÃ´t d'argent sur un compte |
| `RetraitEffectue` | Retrait d'argent d'un compte |
| `VirementEmis` | Ã‰mission d'un virement sortant |
| `VirementRecu` | RÃ©ception d'un virement entrant |
| `PaiementPrimeEffectue` | Paiement d'une prime d'assurance |

### 4.2 Domaine Assurance de Personne

| Ã‰vÃ©nement | Description |
|-----------|-------------|
| `ContratSouscrit` | Souscription d'un contrat vie/santÃ©/prÃ©voyance |
| `ContratResilie` | RÃ©siliation d'un contrat |
| `BeneficiaireModifie` | Modification du bÃ©nÃ©ficiaire d'un contrat |
| `PrimeAppelee` | Appel de prime Ã©mis |
| `PrimeEncaissee` | Prime encaissÃ©e avec succÃ¨s |
| `SinistreVieDepose` | DÃ©claration d'un sinistre vie |
| `IndemnisationVieEmise` | Ã‰mission d'une indemnisation vie |

### 4.3 Domaine Assurance Dommage

| Ã‰vÃ©nement | Description |
|-----------|-------------|
| `ContratAutoSouscrit` | Souscription d'un contrat auto |
| `ContratHabitationSouscrit` | Souscription d'un contrat habitation |
| `ContratResilie` | RÃ©siliation d'un contrat dommage |
| `SinistreAutoDepose` | DÃ©claration d'un sinistre auto |
| `SinistreHabitationDepose` | DÃ©claration d'un sinistre habitation |
| `ExpertisePlanifiee` | Planification d'une expertise |
| `IndemnisationDommageEmise` | Ã‰mission d'une indemnisation dommage |

### 4.4 Domaine Client 360

| Ã‰vÃ©nement | Description |
|-----------|-------------|
| `ProfilClientCree` | CrÃ©ation d'un profil client unifiÃ© |
| `ProfilClientMisAJour` | Mise Ã  jour du profil client |
| `VueUnifieeGeneree` | GÃ©nÃ©ration de la vue 360Â° du client |

---

## 5. Architecture technique

### 5.1 Stack technologique

| Composant | Technologie | Justification |
|-----------|-------------|---------------|
| **Message Broker** | Confluent Platform Community (KRaft) | Standard entreprise, Schema Registry intÃ©grÃ© |
| **SÃ©rialisation** | Apache Avro + Schema Registry | Gouvernance des schÃ©mas, Ã©volution contrÃ´lÃ©e |
| **Langage backend** | Go | Performance, lÃ©gÃ¨retÃ© des conteneurs |
| **Persistance** | PostgreSQL | Polyvalent, ACID, adaptÃ© pour Event Sourcing et Outbox |
| **Frontend** | React + React Flow | Ã‰cosystÃ¨me mature, visualisation de flux interactive |
| **Conteneurisation** | Docker Compose | SimplicitÃ©, environnement local tout-en-un |

### 5.2 Stack d'observabilitÃ©

| Fonction | Outil | Description |
|----------|-------|-------------|
| **MÃ©triques** | Prometheus + Grafana | Dashboards personnalisables, mÃ©triques Kafka |
| **TraÃ§age distribuÃ©** | Jaeger | Suivi des Ã©vÃ©nements Ã  travers les services (OpenTelemetry) |
| **Logs centralisÃ©s** | Loki + Grafana | AgrÃ©gation des logs, intÃ©grÃ© Ã  Grafana |

### 5.3 Architecture des services

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              EDA-LAB                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SERVICES MÃ‰TIER                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  bancaire   â”‚  â”‚ assurance-pers.  â”‚  â”‚ assurance-domm.  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SERVICES TRANSVERSES                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ client-360  â”‚  â”‚   orchestrator   â”‚  â”‚    simulator     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                   â”‚     gateway      â”‚  (API REST + WebSocket)          â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  INFRASTRUCTURE                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Kafka   â”‚ â”‚  Schema Reg â”‚ â”‚ PostgreSQL â”‚ â”‚ Prometheus/Graf â”‚      â”‚
â”‚  â”‚  (KRaft)  â”‚ â”‚  (Confluent)â”‚ â”‚            â”‚ â”‚ Jaeger/Loki     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 Description des services

| Service | ResponsabilitÃ© |
|---------|----------------|
| `bancaire` | Gestion des comptes, transactions, virements |
| `assurance-personne` | Gestion des contrats et sinistres vie/santÃ©/prÃ©voyance |
| `assurance-dommage` | Gestion des contrats et sinistres auto/habitation |
| `client-360` | AgrÃ©gation de la vue client unifiÃ©e |
| `orchestrator` | Coordination des sagas et transactions distribuÃ©es |
| `simulator` | GÃ©nÃ©ration automatique d'Ã©vÃ©nements fictifs |
| `gateway` | API REST pour le contrÃ´le + WebSocket pour temps rÃ©el |

---

## 6. Convention de nommage Kafka

### 6.1 Format des topics

**Pattern :** `<domaine>.<entite>.<action>`

**Convention de correspondance Ã‰vÃ©nement â†’ Topic :**

| Ã‰vÃ©nement (PascalCase) | Topic (kebab-case) |
|------------------------|-------------------|
| `CompteOuvert` | `bancaire.compte.ouvert` |
| `DepotEffectue` | `bancaire.depot.effectue` |
| `PaiementPrimeEffectue` | `bancaire.paiement-prime.effectue` |

**RÃ¨gles :**
- Les mots composÃ©s dans l'entitÃ© utilisent le tiret (`paiement-prime`)
- L'action est toujours en minuscules (`ouvert`, `effectue`, `emis`)
- Le domaine correspond au service Ã©metteur

### 6.2 Catalogue des topics

| Domaine | Topics |
|---------|--------|
| **Bancaire** | `bancaire.compte.ouvert`, `bancaire.compte.ferme`, `bancaire.depot.effectue`, `bancaire.retrait.effectue`, `bancaire.virement.emis`, `bancaire.virement.recu`, `bancaire.paiement-prime.effectue` |
| **Assurance Personne** | `assurance-personne.contrat.souscrit`, `assurance-personne.contrat.resilie`, `assurance-personne.beneficiaire.modifie`, `assurance-personne.prime.appelee`, `assurance-personne.prime.encaissee`, `assurance-personne.sinistre.depose`, `assurance-personne.indemnisation.emise` |
| **Assurance Dommage** | `assurance-dommage.contrat-auto.souscrit`, `assurance-dommage.contrat-habitation.souscrit`, `assurance-dommage.contrat.resilie`, `assurance-dommage.sinistre-auto.depose`, `assurance-dommage.sinistre-habitation.depose`, `assurance-dommage.expertise.planifiee`, `assurance-dommage.indemnisation.emise` |
| **Client 360** | `client.profil.cree`, `client.profil.mis-a-jour`, `client.vue-unifiee.generee` |
| **SystÃ¨me** | `system.dlq`, `system.saga.events` |

---

## 7. Interface utilisateur

### 7.1 Web UI - ContrÃ´le de simulation

| FonctionnalitÃ© | Description |
|----------------|-------------|
| **Start/Stop** | Boutons pour dÃ©marrer et arrÃªter la simulation |
| **SÃ©lection de scÃ©nario** | Choix parmi les scÃ©narios YAML prÃ©dÃ©finis |
| **ParamÃ¨tres dynamiques** | Ajustement du dÃ©bit, durÃ©e, etc. Ã  la volÃ©e |
| **DÃ©clenchement chaos** | Boutons pour activer les scÃ©narios de dÃ©faillance |

### 7.2 Dashboard de visualisation (React Flow)

| FonctionnalitÃ© | Description |
|----------------|-------------|
| **Graphe des services** | Visualisation des nodes (services) et edges (flux) |
| **Animation temps rÃ©el** | Ã‰vÃ©nements circulant entre services avec animation |
| **Compteurs live** | Nombre d'Ã©vÃ©nements par topic |
| **Ã‰tat des services** | Indicateurs de santÃ© (vert/orange/rouge) |

### 7.3 Grafana Dashboards

| Dashboard | MÃ©triques |
|-----------|-----------|
| **Kafka Overview** | Messages/sec, lag consommateurs, partitions |
| **Services Health** | CPU, mÃ©moire, latence par service |
| **Tracing** | DurÃ©e des transactions, erreurs |
| **Business Metrics** | Ã‰vÃ©nements par domaine, flux d'interopÃ©rabilitÃ© |

---

## 8. Configuration des scÃ©narios

### 8.1 Format de configuration

Les scÃ©narios sont dÃ©finis en **YAML** et modifiables via l'interface Web.

### 8.2 Structure d'un scÃ©nario

```yaml
scenario:
  name: "flux-paiement-prime"
  description: "Simulation du flux de paiement de prime d'assurance"
  duration: 300s

  producers:
    - domain: bancaire
      event: compte-ouvert
      rate: 10/s
      data_generator: fake-client

    - domain: assurance-personne
      event: contrat-souscrit
      rate: 5/s
      depends_on: bancaire.compte.ouvert

    - domain: assurance-personne
      event: prime-appelee
      rate: 5/s
      delay: 10s

  consumers:
    - service: bancaire
      topics:
        - assurance-personne.prime.appelee
      action: paiement-prime

  assertions:
    - topic: bancaire.paiement.prime
      min_count: 100
      max_latency: 500ms

  chaos:
    - type: consumer-lag
      target: service-bancaire
      trigger_at: 60s
      duration: 30s
```

### 8.3 ScÃ©narios prÃ©dÃ©finis

| ScÃ©nario | Description | Flux exercÃ© |
|----------|-------------|-------------|
| `flux-client-360` | CrÃ©ation de clients multi-domaines | Vision 360Â° |
| `flux-paiement-prime` | Appel et paiement de primes | Paiement primes |
| `flux-sinistre-auto` | DÃ©claration et indemnisation sinistre | Indemnisation |
| `flux-complet` | Cycle de vie complet client | Tous les flux |
| `stress-test` | Charge Ã©levÃ©e pour tester les limites | Performance |

---

## 9. Chaos Engineering

### 9.1 ScÃ©narios de dÃ©faillance

| Type | Description | Apprentissage visÃ© |
|------|-------------|-------------------|
| **Consumer Lag** | Ralentir un consommateur pour accumuler du retard | Observer le backpressure, mÃ©triques de lag |
| **Service Down** | ArrÃªter un service temporairement | Tester la rÃ©silience, retry, Dead Letter Queue |
| **Network Latency** | Injecter de la latence rÃ©seau entre services | Impact sur les timeouts, comportement des sagas |
| **Duplicate Events** | Produire des Ã©vÃ©nements en double | Valider l'idempotence des consommateurs |
| **Schema Evolution** | Modifier un schÃ©ma Avro en cours de simulation | Tester la compatibilitÃ© avant/arriÃ¨re |

### 9.2 DÃ©clenchement

- **Via Interface Web** : Boutons dÃ©diÃ©s pour chaque type de chaos
- **Via YAML** : Configuration dans les scÃ©narios avec `trigger_at` et `duration`
- **Via API REST** : Endpoints pour automatisation

---

## 10. Structure du repository

### 10.1 Organisation (Monorepo)

```
eda-lab/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ bancaire/
â”‚   â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â””â”€â”€ go.mod
â”‚   â”œâ”€â”€ assurance-personne/
â”‚   â”œâ”€â”€ assurance-dommage/
â”‚   â”œâ”€â”€ client-360/
â”‚   â”œâ”€â”€ orchestrator/
â”‚   â”œâ”€â”€ simulator/
â”‚   â””â”€â”€ gateway/
â”‚
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ bancaire/
â”‚   â”‚   â”œâ”€â”€ compte-ouvert.avsc
â”‚   â”‚   â”œâ”€â”€ virement-emis.avsc
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ assurance-personne/
â”‚   â”œâ”€â”€ assurance-dommage/
â”‚   â””â”€â”€ client/
â”‚
â”œâ”€â”€ web-ui/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ infra/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ docker-compose.observability.yml
â”‚   â”œâ”€â”€ kafka/
â”‚   â”œâ”€â”€ grafana/
â”‚   â”‚   â””â”€â”€ dashboards/
â”‚   â”œâ”€â”€ prometheus/
â”‚   â”‚   â””â”€â”€ prometheus.yml
â”‚   â”œâ”€â”€ jaeger/
â”‚   â””â”€â”€ loki/
â”‚
â”œâ”€â”€ scenarios/
â”‚   â”œâ”€â”€ flux-client-360.yaml
â”‚   â”œâ”€â”€ flux-paiement-prime.yaml
â”‚   â”œâ”€â”€ flux-sinistre-auto.yaml
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ INSTALLATION.md
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â”œâ”€â”€ patterns/
â”‚   â”‚   â”œâ”€â”€ 01-pub-sub.md
â”‚   â”‚   â”œâ”€â”€ 02-event-sourcing.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ adr/
â”‚   â”‚   â”œâ”€â”€ 001-choix-kafka.md
â”‚   â”‚   â”œâ”€â”€ 002-choix-avro.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ scenarios/
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start.sh
â”‚   â”œâ”€â”€ stop.sh
â”‚   â”œâ”€â”€ reset.sh
â”‚   â””â”€â”€ create-topics.sh
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

---

## 11. StratÃ©gie de tests

### 11.1 Niveaux de tests

| Niveau | Outils | Couverture |
|--------|--------|------------|
| **Unitaires** | Go testing, testify | Logique mÃ©tier, transformations d'Ã©vÃ©nements, validations |
| **IntÃ©gration** | testcontainers-go | Kafka rÃ©el, PostgreSQL rÃ©el en containers Ã©phÃ©mÃ¨res |
| **E2E** | Scripts Go + assertions | ScÃ©narios complets de bout en bout |

### 11.2 Couverture cible

| Composant | Couverture minimale |
|-----------|---------------------|
| Services mÃ©tier | 80% |
| Orchestrator | 90% |
| Simulator | 70% |
| Gateway | 75% |

---

## 12. Gestion des erreurs et rÃ©silience

### 12.1 StratÃ©gie de retry

| Composant | StratÃ©gie | Configuration |
|-----------|-----------|---------------|
| **Producer Kafka** | Retry avec backoff exponentiel | max_retries=3, initial_backoff=100ms, max_backoff=10s |
| **Consumer Kafka** | Retry avant DLQ | max_attempts=3, delay=1s |
| **Appels HTTP** | Retry avec circuit breaker | max_retries=3, timeout=5s |
| **Database** | Retry connexion | max_retries=5, backoff=2s |

### 12.2 Dead Letter Queue (DLQ)

| Ã‰lÃ©ment | Configuration |
|---------|---------------|
| **Topic DLQ** | `system.dlq` |
| **Format** | Message original + mÃ©tadonnÃ©es d'erreur |
| **RÃ©tention** | 7 jours |
| **Monitoring** | Alerte si > 10 messages/minute |

**Structure message DLQ :**
```json
{
  "original_topic": "bancaire.compte.ouvert",
  "original_message": { ... },
  "error": {
    "type": "DESERIALIZATION_ERROR",
    "message": "Invalid Avro schema",
    "timestamp": "2024-01-01T00:00:00Z",
    "attempt_count": 3
  },
  "metadata": {
    "service": "bancaire",
    "consumer_group": "bancaire-group"
  }
}
```

### 12.3 Idempotence

| Ã‰vÃ©nement | ClÃ© d'idempotence | StratÃ©gie |
|-----------|-------------------|-----------|
| CompteOuvert | `compte_id` | INSERT ... ON CONFLICT DO NOTHING |
| DepotEffectue | `event_id` | Table de tracking des Ã©vÃ©nements traitÃ©s |
| VirementEmis | `event_id` | Table de tracking des Ã©vÃ©nements traitÃ©s |

### 12.4 Circuit Breaker

| Service | Seuil ouverture | Timeout demi-ouvert | Seuil fermeture |
|---------|-----------------|---------------------|-----------------|
| Gateway â†’ Simulator | 5 erreurs/30s | 30s | 3 succÃ¨s consÃ©cutifs |
| Gateway â†’ Bancaire | 5 erreurs/30s | 30s | 3 succÃ¨s consÃ©cutifs |

---

## 13. Documentation

### 13.1 Structure de la documentation

| Document | Contenu |
|----------|---------|
| `README.md` | Vue d'ensemble, quickstart, liens |
| `INSTALLATION.md` | PrÃ©requis, installation pas Ã  pas |
| `ARCHITECTURE.md` | Diagrammes C4, dÃ©cisions techniques |
| `patterns/*.md` | Guide dÃ©taillÃ© par patron EDA |
| `adr/*.md` | Architecture Decision Records |
| `scenarios/*.md` | Documentation des scÃ©narios |

### 13.2 Architecture Decision Records (ADR)

| ADR | DÃ©cision |
|-----|----------|
| ADR-001 | Choix de Confluent Platform Community pour Kafka |
| ADR-002 | Choix d'Avro pour la sÃ©rialisation |
| ADR-003 | Choix de Go comme langage principal |
| ADR-004 | Choix de PostgreSQL comme base de donnÃ©es |
| ADR-005 | Choix de React + React Flow pour le frontend |
| ADR-006 | Architecture monorepo |

---

## 14. Environnement d'exÃ©cution

### 14.1 PrÃ©requis

| Ã‰lÃ©ment | Version minimale |
|---------|------------------|
| **OS** | Windows 11 |
| **Docker Desktop** | 4.x avec WSL2 |
| **Docker Compose** | v2.x |
| **Go** | 1.21+ |
| **Node.js** | 20 LTS |

### 14.2 Ressources recommandÃ©es

| Ressource | Minimum | RecommandÃ© |
|-----------|---------|------------|
| **RAM** | 8 Go | 16 Go |
| **CPU** | 4 cores | 8 cores |
| **Disque** | 20 Go | 50 Go |

---

## 15. Roadmap des itÃ©rations

### 15.1 MVP (ItÃ©ration 1)

| Composant | Statut |
|-----------|--------|
| Patron Pub/Sub | âœ… Inclus |
| Domaine Bancaire (3-4 Ã©vÃ©nements) | âœ… Inclus |
| Service Simulator | âœ… Inclus |
| Infrastructure Kafka + Schema Registry | âœ… Inclus |
| ObservabilitÃ© de base (Prometheus + Grafana) | âœ… Inclus |
| _Note: Jaeger et Loki prÃ©vus pour ItÃ©ration 2_ | |
| Web UI minimale (Start/Stop + React Flow) | âœ… Inclus |
| Tests unitaires + intÃ©gration | âœ… Inclus |
| Documentation de base | âœ… Inclus |

### 15.2 ItÃ©ration 2

| Composant | Statut |
|-----------|--------|
| Domaines Assurance Personne + Dommage | ğŸ”œ PlanifiÃ© |
| Event Sourcing | ğŸ”œ PlanifiÃ© |
| Jaeger (traÃ§age distribuÃ©) | ğŸ”œ PlanifiÃ© |
| Loki (logs centralisÃ©s) | ğŸ”œ PlanifiÃ© |

### 15.3 ItÃ©ration 3

| Composant | Statut |
|-----------|--------|
| CQRS | ğŸ”œ PlanifiÃ© |
| Client 360 | ğŸ”œ PlanifiÃ© |
| Chaos Engineering | ğŸ”œ PlanifiÃ© |

### 15.4 ItÃ©rations suivantes

| Composant | Statut |
|-----------|--------|
| Saga Choreography | ğŸ”œ PlanifiÃ© |
| Saga Orchestration | ğŸ”œ PlanifiÃ© |
| Event Streaming (Kafka Streams) | ğŸ”œ PlanifiÃ© |
| Dead Letter Queue | ğŸ”œ PlanifiÃ© |
| Outbox Pattern | ğŸ”œ PlanifiÃ© |

---

## 16. Glossaire

| Terme | DÃ©finition |
|-------|------------|
| **EDA** | Event Driven Architecture - Architecture pilotÃ©e par les Ã©vÃ©nements |
| **Pub/Sub** | Pattern Publish/Subscribe - Publication et abonnement aux Ã©vÃ©nements |
| **Event Sourcing** | Pattern oÃ¹ l'Ã©tat est dÃ©rivÃ© d'une sÃ©quence d'Ã©vÃ©nements |
| **CQRS** | Command Query Responsibility Segregation - SÃ©paration lecture/Ã©criture |
| **Saga** | Pattern de gestion des transactions distribuÃ©es |
| **DLQ** | Dead Letter Queue - File pour les Ã©vÃ©nements en erreur |
| **Outbox** | Pattern garantissant la livraison transactionnelle des Ã©vÃ©nements |
| **Schema Registry** | Service de gestion et validation des schÃ©mas Avro |
| **KRaft** | Mode Kafka sans ZooKeeper |

---

## 17. RÃ©fÃ©rences

- [Apache Kafka Documentation](https://kafka.apache.org/documentation/)
- [Confluent Platform](https://docs.confluent.io/)
- [Apache Avro Specification](https://avro.apache.org/docs/current/spec.html)
- [React Flow](https://reactflow.dev/)
- [Grafana Documentation](https://grafana.com/docs/)
- [OpenTelemetry](https://opentelemetry.io/)
- [testcontainers-go](https://golang.testcontainers.org/)

---

**Document gÃ©nÃ©rÃ© le 2026-01-19**
**Outil : Claude Code**
